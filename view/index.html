<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .login-card {
            width: 100%;
            max-width: 400px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }
    </style>
</head>
<body>
    <div class="login-container" id="login-section">
        <div class="card login-card">
            <div class="card-body p-5">
                <div class="text-center mb-4">
                    <h2 class="text-primary"><i class="fas fa-store me-2"></i>Sistema de Gestão</h2>
                    <p class="text-muted">Faça login para acessar o sistema</p>
                </div>
                <form id="login-form">
                    <div class="mb-3">
                        <label for="email" class="form-label">E-mail</label>
                        <input type="email" class="form-control" id="email" required value="admin@email.com">
                    </div>
                    <div class="mb-3">
                        <label for="senha" class="form-label">Senha</label>
                        <input type="password" class="form-control" id="senha" required value="password">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Entrar</button>
                </form>
                <div class="alert alert-danger mt-3" id="login-error" style="display: none;"></div>
                
                <!-- Adicionando informações de debug -->
                <div class="mt-3 p-3 bg-light rounded">
                    <h6 class="text-muted">Informações de Debug:</h6>
                    <small id="debug-info">Pronto para testar...</small>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import ApiService from './ApiService.js';
        
        let apiService = new ApiService();
        
        // Adicionar informações de debug
        const debugInfo = document.getElementById('debug-info');
        debugInfo.textContent = 'API Service carregado. Aguardando login...';
        
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            
            debugInfo.textContent = 'Enviando requisição de login...';
            document.getElementById('login-error').style.display = 'none';
            
            try {
                const resultado = await apiService.post('http://localhost/auth/login', {
                    email, senha
                });
                
                debugInfo.textContent = 'Resposta recebida: ' + JSON.stringify(resultado);
                
                if (resultado.success) {
                    debugInfo.textContent = 'Login bem-sucedido! Redirecionando...';
                    apiService.token = resultado.data.token;
                    localStorage.setItem('jwt_token', resultado.data.token);
                    localStorage.setItem('usuario', JSON.stringify(resultado.data.usuario));
                    
                    // Redireciona para a página de categorias
                    window.location.href = 'categorias.html';
                } else {
                    document.getElementById('login-error').textContent = resultado.message;
                    document.getElementById('login-error').style.display = 'block';
                    debugInfo.textContent = 'Erro no login: ' + resultado.message;
                }
            } catch (error) {
                const errorMsg = 'Erro ao realizar login. Verifique a conexão. Detalhes: ' + error.message;
                document.getElementById('login-error').textContent = errorMsg;
                document.getElementById('login-error').style.display = 'block';
                debugInfo.textContent = 'Erro completo: ' + error;
                console.error('Erro completo:', error);
            }
        });

        // Verifica se já está logado
        const token = localStorage.getItem('jwt_token');
        if (token) {
            debugInfo.textContent = 'Token encontrado no localStorage. Redirecionando...';
            window.location.href = 'categorias.html';
        } else {
            debugInfo.textContent = 'Nenhum token encontrado no localStorage. Faça login.';
        }
    </script>
</body>
</html>